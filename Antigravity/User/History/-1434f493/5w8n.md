# Cross-Platform Screenshot Implementation Guide

This guide details robust methods for capturing screenshots programmatically across different operating systems, specifically for AI agents or automation tools.

## Windows
**Recommended Library:** `mss`
- **Pros:** Extremely fast, handles multi-monitor setups well.
- **Fallback:** `pyautogui` (uses `Pillow` internally, slower but simple).

```python
def capture_windows(output_path):
    try:
        import mss
        from PIL import Image
        with mss.mss() as sct:
            # Capture the primary monitor
            screenshot = sct.grab(sct.monitors[1]) 
            img = Image.frombytes("RGB", screenshot.size, screenshot.bgra, "raw", "BGRX")
            img.save(output_path)
    except ImportError:
        import pyautogui
        pyautogui.screenshot(output_path)
```

## macOS
**Recommended Tool:** `screencapture` (System CLI)
- **Pros:** Native, reliable, handles Retina displays correctly.
- **Alternative:** `pyautogui` (works well but may require permission adjustments).

```python
import subprocess

def capture_macos(output_path):
    subprocess.run(["screencapture", "-x", str(output_path)], check=True)
```

## Linux

### Wayland (e.g., Hyprland, Sway, GNOME Wayland)
**Recommended Tool:** `grim`
- **Pros:** Native Wayland tool, works reliably for full screen.
- **Note:** Traditional X11 tools like `scrot` or `xwd` will **not** work.
- **Warning:** Attempting to capture specific windows by calculating geometry from window managers (like `hyprctl` on Hyprland) is brittle. Window classes/titles vary, and coordinates can be tricky. **Prefer full-screen capture.**

```python
import subprocess

def capture_wayland(output_path):
    # Captures full screen
    subprocess.run(["grim", str(output_path)], check=True)
```

### X11
**Recommended Tools:** `scrot`, `gnome-screenshot`, `import` (ImageMagick)
- **Pros:** Mature ecosystem.

```python
def capture_x11(output_path):
    subprocess.run(["scrot", str(output_path)], check=True)
```

## Unified Wrapper Example

```python
import sys
import shutil

def capture_screenshot(output_path):
    system = sys.platform
    
    if system == "win32":
        capture_windows(output_path)
    elif system == "darwin":
        capture_macos(output_path)
    elif system == "linux":
        # Check for Wayland
        if "WAYLAND_DISPLAY" in os.environ:
            if shutil.which("grim"):
                capture_wayland(output_path)
            else:
                raise RuntimeError("grim not found on Wayland system")
        else:
            capture_x11(output_path)
```
